<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æ–‡æ¡£å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .code-block {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .method-get { @apply bg-green-100 text-green-800 border-green-200; }
        .method-post { @apply bg-blue-100 text-blue-800 border-blue-200; }
        .method-put { @apply bg-yellow-100 text-yellow-800 border-yellow-200; }
        .method-delete { @apply bg-red-100 text-red-800 border-red-200; }
        .method-patch { @apply bg-purple-100 text-purple-800 border-purple-200; }

        /* APIçŠ¶æ€é¢œè‰²æ ·å¼ */
        .status-success {
            @apply bg-green-100 text-green-800 border border-green-200;
        }
        .status-info {
            @apply bg-blue-100 text-blue-800 border border-blue-200;
        }
        .status-warning {
            @apply bg-yellow-100 text-yellow-800 border border-yellow-200;
        }
        .status-danger {
            @apply bg-red-100 text-red-800 border border-red-200;
        }

        /* APIçŠ¶æ€å¾½ç« æ ·å¼å¢å¼º */
        .status-badge {
            font-weight: 500;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* ä¸ºä¸åŒçŠ¶æ€æ·»åŠ å›¾æ ‡ */
        .status-success::before { content: "âœ…"; }
        .status-info::before { content: "ğŸ§ª"; }
        .status-warning::before { content: "ğŸš§"; }
        .status-danger::before { content: "âš ï¸"; }

        .sidebar-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .sidebar-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .group-toggle {
            transition: transform 0.2s ease;
            display: inline-block;
            user-select: none;
        }

        .group-toggle.expanded {
            transform: rotate(90deg);
        }

        .group-apis {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .group-apis.expanded {
            max-height: 2000px;
        }

        .group-header:hover {
            background-color: #f8fafc;
        }

        .api-path {
            word-break: break-all;
            overflow-wrap: break-word;
            line-height: 1.3;
        }

        .api-path-short {
            display: block;
        }

        .api-path-full {
            display: none;
        }

        .api-item:hover .api-path-short {
            display: none;
        }

        .api-item:hover .api-path-full {
            display: block;
        }

        .path-tooltip {
            position: relative;
        }

        .path-tooltip:hover::after {
            content: attr(data-full-path);
            position: absolute;
            left: 0;
            top: 100%;
            z-index: 1000;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .api-item-compact {
            transition: all 0.2s ease;
        }

        .api-item-compact:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center justify-between px-6 py-3">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold text-gray-900">ğŸ”§ APIæ–‡æ¡£å·¥å…·</h1>
                <div class="hidden md:flex items-center space-x-4">
                    <input type="text" id="search-input" placeholder="æœç´¢API..."
                           class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <select id="environment-select" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">æ‰€æœ‰ç¯å¢ƒ</option>
                        <option value="development">å¼€å‘ç¯å¢ƒ</option>
                        <option value="test">æµ‹è¯•ç¯å¢ƒ</option>
                        <option value="production">ç”Ÿäº§ç¯å¢ƒ</option>
                    </select>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 text-gray-500 hover:text-gray-700 focus:outline-none">
                    <span class="dark:hidden">ğŸŒ™</span>
                    <span class="hidden dark:inline">â˜€ï¸</span>
                </button>
                <button id="refresh-btn" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    åˆ·æ–°
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex mt-16">
        <!-- Sidebar -->
        <aside class="w-80 bg-white shadow-sm border-r border-gray-200 fixed left-0 top-16 bottom-0 overflow-y-auto sidebar-scrollbar">
            <div class="p-4">
                <!-- Quick Stats -->
                <div class="mb-6 p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-gray-600">APIç»Ÿè®¡</div>
                        <div class="flex space-x-1">
                            <button id="expand-all" class="text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded hover:bg-blue-50" title="å±•å¼€æ‰€æœ‰åˆ†ç»„">
                                â†“
                            </button>
                            <button id="collapse-all" class="text-xs text-gray-600 hover:text-gray-800 px-2 py-1 rounded hover:bg-gray-50" title="æŠ˜å æ‰€æœ‰åˆ†ç»„">
                                â†‘
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between text-xs">
                        <span>æ€»è®¡: <span id="total-apis" class="font-semibold">0</span></span>
                        <span>åˆ†ç»„: <span id="total-groups" class="font-semibold">0</span></span>
                    </div>
                </div>

                <!-- API Groups -->
                <div id="api-groups">
                    <!-- Groups will be loaded here -->
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 ml-80 p-6">
            <!-- Welcome Message -->
            <div id="welcome-message" class="text-center py-12">
                <div class="text-6xl mb-4">ğŸš€</div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">æ¬¢è¿ä½¿ç”¨APIæ–‡æ¡£å·¥å…·</h2>
                <p class="text-gray-600 mb-6">è½»é‡çº§ â€¢ é›¶é…ç½® â€¢ å¼€ç®±å³ç”¨</p>
                <div class="flex justify-center space-x-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                        <div class="text-sm text-gray-500">ğŸ¯</div>
                        <div class="text-lg font-semibold text-gray-900">è‡ªåŠ¨è§£æ</div>
                        <div class="text-sm text-gray-600">åŸºäºæ³¨è§£æ™ºèƒ½ç”Ÿæˆ</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                        <div class="text-sm text-gray-500">âš¡</div>
                        <div class="text-lg font-semibold text-gray-900">å¿«é€Ÿæµ‹è¯•</div>
                        <div class="text-sm text-gray-600">åœ¨çº¿APIæµ‹è¯•</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                        <div class="text-sm text-gray-500">ğŸ¨</div>
                        <div class="text-lg font-semibold text-gray-900">ç°ä»£ç•Œé¢</div>
                        <div class="text-sm text-gray-600">ç®€æ´ç¾è§‚çš„è®¾è®¡</div>
                    </div>
                </div>
            </div>

            <!-- API Detail -->
            <div id="api-detail" class="hidden">
                <!-- API Header -->
                <div id="api-header" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <!-- Content will be populated by JavaScript -->
                </div>

                <!-- API Tabs -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6">
                            <button class="api-tab py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600" data-tab="documentation">
                                ğŸ“„ æ–‡æ¡£
                            </button>
                            <button class="api-tab py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="testing">
                                ğŸ§ª æµ‹è¯•
                            </button>
                            <button class="api-tab py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="examples">
                                ğŸ“‹ ç¤ºä¾‹
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div class="p-6">
                        <!-- Documentation Tab -->
                        <div id="tab-documentation" class="tab-content">
                            <div id="api-documentation">
                                <!-- Documentation content -->
                            </div>
                        </div>

                        <!-- Testing Tab -->
                        <div id="tab-testing" class="tab-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Request Configuration -->
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ¯ è¯·æ±‚é…ç½®</h3>

                                    <!-- Headers -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Headers</label>
                                        <div id="headers-container">
                                            <!-- Headers will be added dynamically -->
                                        </div>
                                        <button id="add-header" class="text-sm text-blue-600 hover:text-blue-800">+ æ·»åŠ Header</button>
                                    </div>

                                    <!-- Request Body -->
                                    <div id="request-body-section" class="mb-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <label class="block text-sm font-medium text-gray-700">Request Body</label>
                                            <button id="generate-example-btn" class="text-sm text-blue-600 hover:text-blue-800 px-2 py-1 rounded hover:bg-blue-50 flex items-center">
                                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                                </svg>
                                                ç”Ÿæˆç¤ºä¾‹
                                            </button>
                                        </div>
                                        <textarea id="request-body" rows="8"
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm code-block"
                                                  placeholder="è¯·æ±‚ä½“JSON"></textarea>
                                    </div>

                                    <!-- Parameters -->
                                    <div id="parameters-section" class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">å‚æ•°</label>
                                        <div id="parameters-container">
                                            <!-- Parameters will be populated -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Request Preview & Response -->
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“‹ è¯·æ±‚é¢„è§ˆ</h3>

                                    <!-- Request Preview -->
                                    <div class="mb-4">
                                        <pre id="request-preview" class="bg-gray-50 p-4 rounded-md text-sm code-block border border-gray-200"></pre>
                                    </div>

                                    <!-- Send Button -->
                                    <div class="mb-4">
                                        <button id="send-request" class="w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                            ğŸš€ å‘é€è¯·æ±‚
                                        </button>
                                    </div>

                                    <!-- Response -->
                                    <div id="response-section" class="hidden">
                                        <h4 class="text-md font-semibold text-gray-900 mb-2">ğŸ“Š å“åº”ç»“æœ</h4>

                                        <!-- Response Status -->
                                        <div id="response-status" class="mb-3 p-3 rounded-md">
                                            <!-- Status will be populated -->
                                        </div>

                                        <!-- Response Body -->
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Response Body</label>
                                            <pre id="response-body" class="bg-gray-50 p-4 rounded-md text-sm code-block border border-gray-200 max-h-96 overflow-y-auto"></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Examples Tab -->
                        <div id="tab-examples" class="tab-content hidden">
                            <div id="api-examples">
                                <!-- Examples content -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="flex items-center space-x-3">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
                <span class="text-gray-700">åŠ è½½ä¸­...</span>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentApiDoc = null;
        let selectedApi = null;

        // DOMå…ƒç´ 
        const searchInput = document.getElementById('search-input');
        const environmentSelect = document.getElementById('environment-select');
        const refreshBtn = document.getElementById('refresh-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const apiGroups = document.getElementById('api-groups');
        const welcomeMessage = document.getElementById('welcome-message');
        const apiDetail = document.getElementById('api-detail');
        const loadingOverlay = document.getElementById('loading-overlay');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadApiDocumentation();
            bindEvents();
        });

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æœç´¢åŠŸèƒ½
            searchInput.addEventListener('input', debounce(handleSearch, 300));

            // ç¯å¢ƒåˆ‡æ¢
            environmentSelect.addEventListener('change', handleEnvironmentChange);

            // åˆ·æ–°æŒ‰é’®
            refreshBtn.addEventListener('click', handleRefresh);

            // ä¸»é¢˜åˆ‡æ¢
            themeToggle.addEventListener('click', handleThemeToggle);

            // Tabåˆ‡æ¢
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('api-tab')) {
                    handleTabSwitch(e.target.dataset.tab);
                }
            });

            // APIé¡¹ç›®ç‚¹å‡»
            document.addEventListener('click', function(e) {
                if (e.target.closest('.api-item')) {
                    const apiIndex = e.target.closest('.api-item').dataset.apiIndex;
                    showApiDetail(apiIndex);
                }
            });

            // åˆ†ç»„æŠ˜å å±•å¼€
            document.addEventListener('click', function(e) {
                if (e.target.closest('.group-header')) {
                    const groupElement = e.target.closest('.api-group');
                    const toggleIcon = groupElement.querySelector('.group-toggle');
                    const apisContainer = groupElement.querySelector('.group-apis');

                    toggleIcon.classList.toggle('expanded');
                    apisContainer.classList.toggle('expanded');

                    // ä¿å­˜æŠ˜å çŠ¶æ€åˆ°localStorage
                    const groupName = groupElement.dataset.groupName;
                    const isExpanded = apisContainer.classList.contains('expanded');
                    localStorage.setItem(`group-${groupName}`, isExpanded);
                }
            });

            // å±•å¼€æ‰€æœ‰åˆ†ç»„
            document.addEventListener('click', function(e) {
                if (e.target.id === 'expand-all') {
                    document.querySelectorAll('.api-group').forEach(groupElement => {
                        const toggleIcon = groupElement.querySelector('.group-toggle');
                        const apisContainer = groupElement.querySelector('.group-apis');
                        const groupName = groupElement.dataset.groupName;

                        toggleIcon.classList.add('expanded');
                        apisContainer.classList.add('expanded');
                        localStorage.setItem(`group-${groupName}`, true);
                    });
                }
            });

            // æŠ˜å æ‰€æœ‰åˆ†ç»„
            document.addEventListener('click', function(e) {
                if (e.target.id === 'collapse-all') {
                    document.querySelectorAll('.api-group').forEach(groupElement => {
                        const toggleIcon = groupElement.querySelector('.group-toggle');
                        const apisContainer = groupElement.querySelector('.group-apis');
                        const groupName = groupElement.dataset.groupName;

                        toggleIcon.classList.remove('expanded');
                        apisContainer.classList.remove('expanded');
                        localStorage.setItem(`group-${groupName}`, false);
                    });
                }
            });

            // å‘é€è¯·æ±‚
            document.addEventListener('click', function(e) {
                if (e.target.id === 'send-request') {
                    handleSendRequest();
                }
            });

            // æ·»åŠ Header
            document.addEventListener('click', function(e) {
                if (e.target.id === 'add-header') {
                    addHeaderRow();
                }
            });

            // åˆ é™¤Header
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-header')) {
                    removeHeaderRow(e.target);
                }
            });

            // Headerè¾“å…¥å˜åŒ–æ—¶æ›´æ–°é¢„è§ˆ
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('header-key') || e.target.classList.contains('header-value')) {
                    updateRequestPreview();
                }
            });

            // ç”Ÿæˆç¤ºä¾‹æ•°æ®
            document.addEventListener('click', function(e) {
                if (e.target.id === 'generate-example-btn' || e.target.closest('#generate-example-btn')) {
                    generateAndFillExample();
                }
            });
        }

        // ç”Ÿæˆå¹¶å¡«å……ç¤ºä¾‹æ•°æ®
        function generateAndFillExample() {
            if (!selectedApi) return;

            const requestBodyTextarea = document.getElementById('request-body');
            if (requestBodyTextarea) {
                const exampleData = generateRequestBodyExample(selectedApi);
                if (exampleData) {
                    requestBodyTextarea.value = exampleData;
                    // æ›´æ–°è¯·æ±‚é¢„è§ˆ
                    updateRequestPreview();

                    // æ·»åŠ è§†è§‰åé¦ˆ
                    requestBodyTextarea.style.borderColor = '#10B981';
                    setTimeout(() => {
                        requestBodyTextarea.style.borderColor = '';
                    }, 1000);
                } else {
                    // å¦‚æœæ²¡æœ‰ç”Ÿæˆç¤ºä¾‹æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
                    requestBodyTextarea.placeholder = 'æ— æ³•ç”Ÿæˆç¤ºä¾‹æ•°æ®ï¼šæœªæ‰¾åˆ°å¯¹è±¡ç±»å‹çš„è¯·æ±‚å‚æ•°';
                }
            }
        }

        // æ·»åŠ Headerè¡Œ
        function addHeaderRow(key = '', value = '') {
            const container = document.getElementById('headers-container');
            const headerRow = document.createElement('div');
            headerRow.className = 'flex space-x-2 mb-2 header-row';
            headerRow.innerHTML = `
                <input type="text" placeholder="Key" value="${key}"
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm header-key">
                <input type="text" placeholder="Value" value="${value}"
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm header-value">
                <button class="px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm remove-header">
                    åˆ é™¤
                </button>
            `;
            container.appendChild(headerRow);
            updateRequestPreview();
        }

        // åˆ é™¤Headerè¡Œ
        function removeHeaderRow(button) {
            const headerRow = button.closest('.header-row');
            headerRow.remove();
            updateRequestPreview();
        }

        // è·å–æ‰€æœ‰Headers
        function getAllHeaders() {
            const headers = {};
            document.querySelectorAll('.header-row').forEach(row => {
                const key = row.querySelector('.header-key').value.trim();
                const value = row.querySelector('.header-value').value.trim();
                if (key && value) {
                    headers[key] = value;
                }
            });
            return headers;
        }

        // åˆå§‹åŒ–Headers (æ·»åŠ é»˜è®¤çš„Content-Type)
        function initializeHeaders() {
            const container = document.getElementById('headers-container');
            container.innerHTML = '';
            addHeaderRow('Content-Type', 'application/json');
        }

        // è·¯å¾„å¤„ç†å·¥å…·å‡½æ•°
        function formatApiPath(path) {
            if (!path || path.length <= 30) {
                return {
                    short: path,
                    full: path,
                    needsTruncation: false
                };
            }

            // æ™ºèƒ½æˆªæ–­ï¼šä¿ç•™é‡è¦éƒ¨åˆ†
            const parts = path.split('/').filter(part => part);

            if (parts.length <= 2) {
                // è·¯å¾„å±‚çº§å°‘ï¼Œç›´æ¥æˆªæ–­
                return {
                    short: path.length > 30 ? path.substring(0, 27) + '...' : path,
                    full: path,
                    needsTruncation: path.length > 30
                };
            }

            // ä¿ç•™å¼€å§‹å’Œç»“æŸéƒ¨åˆ†
            const start = '/' + parts[0];
            const end = parts[parts.length - 1];
            const middle = parts.length > 3 ? '/.../' : '/' + parts[1] + '/';

            const shortPath = start + middle + end;

            return {
                short: shortPath.length > 35 ? start + '/.../' + end.substring(0, 15) + '...' : shortPath,
                full: path,
                needsTruncation: true
            };
        }

        // ç”Ÿæˆè·¯å¾„æ˜¾ç¤ºHTML
        function generatePathHtml(path) {
            const pathInfo = formatApiPath(path);

            if (!pathInfo.needsTruncation) {
                return `<span class="api-path">${path}</span>`;
            }

            return `
                <span class="path-tooltip" data-full-path="${pathInfo.full}">
                    <span class="api-path-short api-path">${pathInfo.short}</span>
                    <span class="api-path-full api-path">${pathInfo.full}</span>
                </span>
            `;
        }

        // åŠ è½½APIæ–‡æ¡£
        async function loadApiDocumentation() {
            showLoading(true);
            try {
                const environment = environmentSelect.value;
                const response = await fetch(`/api-doc/documentation?environment=${environment}`);
                currentApiDoc = await response.json();
                renderApiGroups();
                updateStats();
            } catch (error) {
                console.error('åŠ è½½APIæ–‡æ¡£å¤±è´¥:', error);
                showError('åŠ è½½APIæ–‡æ¡£å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ');
            } finally {
                showLoading(false);
            }
        }

        // æ¸²æŸ“APIåˆ†ç»„
        function renderApiGroups() {
            if (!currentApiDoc || !currentApiDoc.groups) {
                apiGroups.innerHTML = '<div class="text-center text-gray-500 py-4">æš‚æ— APIæ–‡æ¡£</div>';
                return;
            }

            let html = '';
            currentApiDoc.groups.forEach((group, groupIndex) => {
                // æ£€æŸ¥localStorageä¸­çš„æŠ˜å çŠ¶æ€
                const isExpanded = localStorage.getItem(`group-${group.name}`) !== 'false';
                const expandedClass = isExpanded ? 'expanded' : '';

                html += `
                    <div class="mb-4 api-group" data-group-name="${group.name}">
                        <div class="group-header cursor-pointer flex items-center justify-between p-2 hover:bg-gray-50 rounded-md">
                            <h3 class="text-sm font-semibold text-gray-900 flex items-center">
                                <span class="group-toggle mr-2 text-gray-400 ${expandedClass}">â–¶</span>
                                <span class="mr-2">ğŸ“</span>
                                ${group.name}
                            </h3>
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${group.apis.length}</span>
                        </div>
                        <div class="group-apis ml-4 ${expandedClass}">
                `;

                group.apis.forEach((api, apiIndex) => {
                    const globalIndex = getGlobalApiIndex(groupIndex, apiIndex);
                    const pathHtml = generatePathHtml(api.path);

                    html += `
                        <div class="api-item api-item-compact cursor-pointer p-3 rounded hover:bg-gray-50 border-l-4 border-transparent hover:border-blue-400 transition-all"
                             data-api-index="${globalIndex}">
                            <!-- ç¬¬ä¸€è¡Œï¼šHTTPæ–¹æ³• + çŠ¶æ€æ ‡ç­¾ -->
                            <div class="flex items-center justify-between mb-2">
                                <span class="method-badge method-${api.method.toLowerCase()} px-2 py-1 rounded text-xs font-medium border">
                                    ${api.method}
                                </span>
                                <span class="status-badge status-${api.statusCss}">
                                    ${api.statusLabel}
                                </span>
                            </div>
                            <!-- ç¬¬äºŒè¡Œï¼šAPIè·¯å¾„ -->
                            <div class="text-sm text-gray-700 mb-1 font-mono">
                                ${pathHtml}
                            </div>
                            <!-- ç¬¬ä¸‰è¡Œï¼šAPIæè¿° -->
                            <div class="text-xs text-gray-600 truncate">
                                ${api.summary}
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
            });

            apiGroups.innerHTML = html;
        }

        // è·å–APIçš„å…¨å±€ç´¢å¼•
        function getGlobalApiIndex(groupIndex, apiIndex) {
            let globalIndex = 0;
            for (let i = 0; i < groupIndex; i++) {
                globalIndex += currentApiDoc.groups[i].apis.length;
            }
            return globalIndex + apiIndex;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            if (!currentApiDoc) return;

            document.getElementById('total-apis').textContent = currentApiDoc.allApis?.length || 0;
            document.getElementById('total-groups').textContent = currentApiDoc.groups?.length || 0;
        }

        // æ˜¾ç¤ºAPIè¯¦æƒ…
        function showApiDetail(globalIndex) {
            const api = findApiByGlobalIndex(parseInt(globalIndex));
            if (!api) return;

            selectedApi = api;
            welcomeMessage.classList.add('hidden');
            apiDetail.classList.remove('hidden');

            renderApiHeader(api);
            renderApiDocumentation(api);
            renderApiTesting(api);
            renderApiExamples(api);
        }

        // æ ¹æ®å…¨å±€ç´¢å¼•æŸ¥æ‰¾API
        function findApiByGlobalIndex(globalIndex) {
            let currentIndex = 0;
            for (const group of currentApiDoc.groups) {
                for (const api of group.apis) {
                    if (currentIndex === globalIndex) {
                        return api;
                    }
                    currentIndex++;
                }
            }
            return null;
        }

        // æ¸²æŸ“APIå¤´éƒ¨
        function renderApiHeader(api) {
            const header = document.getElementById('api-header');
            header.innerHTML = `
                <div class="flex items-start justify-between">
                    <div>
                        <div class="flex items-center space-x-3 mb-2">
                            <span class="method-badge method-${api.method.toLowerCase()} px-3 py-1 rounded-md text-sm font-medium border">
                                ${api.method}
                            </span>
                            <code class="text-lg font-mono text-gray-900">${api.path}</code>
                            <span class="status-badge status-${api.statusCss}">
                                ${api.statusLabel}
                            </span>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900 mb-1">${api.summary}</h2>
                        ${api.description ? `<p class="text-gray-600">${api.description}</p>` : ''}
                    </div>
                    <div class="text-sm text-gray-500">
                        <div>åˆ†ç»„: ${api.group}</div>
                        ${api.version ? `<div>ç‰ˆæœ¬: ${api.version}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // æ¸²æŸ“APIæ–‡æ¡£
        function renderApiDocumentation(api) {
            const doc = document.getElementById('api-documentation');
            let html = '';

            // å‚æ•°ä¿¡æ¯
            if (api.parameters && api.parameters.length > 0) {
                html += `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ“ è¯·æ±‚å‚æ•°</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å‚æ•°å</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç±»å‹</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä½ç½®</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¿…å¡«</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é»˜è®¤å€¼</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç¤ºä¾‹</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è¯´æ˜</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                `;

                api.parameters.forEach(param => {
                    // ç¡®å®šå‚æ•°ä½ç½®çš„ä¸­æ–‡æè¿°
                    let paramLocation = '';
                    if (param.paramType === 'body') {
                        paramLocation = 'Body';
                    } else if (param.paramType === 'path') {
                        paramLocation = 'Path';
                    } else if (param.paramType === 'query') {
                        paramLocation = 'Query';
                    } else if (param.paramType === 'header') {
                        paramLocation = 'Header';
                    } else if (param.paramType === 'file') {
                        paramLocation = 'File';
                    } else {
                        paramLocation = 'Query'; // é»˜è®¤
                    }

                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                <div class="flex items-center">
                                    <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-mono">${param.name}</code>
                                </div>
                            </td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                <code class="bg-gray-100 px-2 py-1 rounded text-xs">${param.type}</code>
                            </td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${paramLocation === 'Body' ? 'bg-purple-100 text-purple-800' : paramLocation === 'Path' ? 'bg-green-100 text-green-800' : paramLocation === 'File' ? 'bg-orange-100 text-orange-800' : 'bg-blue-100 text-blue-800'}">
                                    ${paramLocation === 'File' ? 'ğŸ“ ' + paramLocation : paramLocation}
                                </span>
                            </td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                ${param.required ? '<span class="text-red-600 font-semibold">âœ“ å¿…å¡«</span>' : '<span class="text-gray-400">å¯é€‰</span>'}
                            </td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                ${param.defaultValue ? '<code class="bg-yellow-50 text-yellow-700 px-2 py-1 rounded text-xs">' + param.defaultValue + '</code>' : '<span class="text-gray-400">-</span>'}
                            </td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                ${param.example ? '<code class="bg-green-50 text-green-700 px-2 py-1 rounded text-xs">' + param.example + '</code>' : '<span class="text-gray-400">-</span>'}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                <div class="max-w-xs">
                                    ${param.description || '<span class="text-gray-400 italic">æš‚æ— è¯´æ˜</span>'}
                                </div>
                            </td>
                        </tr>
                    `;

                    // å¦‚æœå‚æ•°æœ‰å­—æ®µè¯¦æƒ…ï¼Œæ˜¾ç¤ºå­å­—æ®µ
                    if (param.fields && param.fields.length > 0) {
                        html += `
                            <tr class="bg-gray-50">
                                <td colspan="7" class="px-4 py-3">
                                    <div class="ml-4">
                                        <h5 class="text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                                            </svg>
                                            å¯¹è±¡å­—æ®µè¯¦æƒ…
                                        </h5>
                                        <div class="bg-white border border-gray-200 rounded-md">
                                            <table class="min-w-full text-sm">
                                                <thead class="bg-gray-100">
                                                    <tr>
                                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">å­—æ®µå</th>
                                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">ç±»å‹</th>
                                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">è¯´æ˜</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    ${renderParameterFieldRows(param.fields, 0)}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }
                });

                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // è¿”å›ä¿¡æ¯
            if (api.returnType) {
                html += `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ“¤ è¿”å›ä¿¡æ¯</h3>
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center space-x-4 mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-gray-700">æ•°æ®ç±»å‹:</span>
                                    <code class="bg-white px-3 py-1 rounded-md text-sm font-mono border shadow-sm">${api.returnType.type}</code>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-gray-700">æ ¼å¼:</span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">JSON</span>
                                </div>
                            </div>
                            ${api.returnType.description ?
                                '<div class="border-t border-blue-200 pt-3">' +
                                    '<span class="text-sm font-medium text-gray-700">è¯´æ˜:</span>' +
                                    '<p class="text-sm text-gray-600 mt-1">' + api.returnType.description + '</p>' +
                                '</div>'
                            : ''}
                            <div class="mt-3 text-xs text-gray-500">
                                <span class="inline-flex items-center">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                    å“åº”æ•°æ®å°†ä»¥JSONæ ¼å¼è¿”å›ï¼Œè¯·æ³¨æ„å¤„ç†æ•°æ®ç±»å‹è½¬æ¢
                                </span>
                            </div>
                        </div>
                `;

                // å¦‚æœæœ‰å­—æ®µä¿¡æ¯ï¼Œæ˜¾ç¤ºå­—æ®µè¯¦æƒ…è¡¨æ ¼
                if (api.returnType.fields && api.returnType.fields.length > 0) {
                    html += renderReturnTypeFields(api.returnType.fields);
                }

                html += `</div>`;
            }

            doc.innerHTML = html || '<div class="text-gray-500">æš‚æ— è¯¦ç»†æ–‡æ¡£</div>';
        }

        // æ¸²æŸ“è¿”å›ç±»å‹å­—æ®µè¡¨æ ¼
        function renderReturnTypeFields(fields) {
            return `
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <div class="px-4 py-3 bg-gray-50 border-b border-gray-200">
                        <h4 class="text-md font-semibold text-gray-900 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                            </svg>
                            å­—æ®µè¯¦æƒ…
                        </h4>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å­—æ®µå</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•°æ®ç±»å‹</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${renderFieldRows(fields, 0)}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // é€’å½’æ¸²æŸ“å­—æ®µè¡Œï¼ˆæ”¯æŒåµŒå¥—å¯¹è±¡ï¼‰
        function renderFieldRows(fields, level) {
            let html = '';
            fields.forEach(field => {
                const hasChildren = field.children && field.children.length > 0;
                const indentStyle = 'padding-left: ' + (level * 20) + 'px';

                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                            <div class="flex items-center" style="${indentStyle}">
                                ${hasChildren ?
                                    '<svg class="w-3 h-3 mr-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>' :
                                    '<span class="w-3 mr-1"></span>'
                                }
                                <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-mono">${field.name}</code>
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getFieldTypeClass(field.type)}">
                                ${field.type}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-600">
                            <div class="max-w-xs">
                                ${field.description || '<span class="text-gray-400 italic">æš‚æ— è¯´æ˜</span>'}
                            </div>
                        </td>
                    </tr>
                `;

                // é€’å½’æ¸²æŸ“å­å­—æ®µ
                if (hasChildren) {
                    html += renderFieldRows(field.children, level + 1);
                }
            });
            return html;
        }

        // è·å–å­—æ®µç±»å‹çš„CSSç±»
        function getFieldTypeClass(type) {
            switch(type.toLowerCase()) {
                case 'string': return 'bg-green-100 text-green-800';
                case 'integer': case 'int': case 'long': return 'bg-blue-100 text-blue-800';
                case 'double': case 'float': return 'bg-purple-100 text-purple-800';
                case 'boolean': return 'bg-yellow-100 text-yellow-800';
                case 'enum': return 'bg-orange-100 text-orange-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // é€’å½’æ¸²æŸ“å‚æ•°å­—æ®µè¡Œï¼ˆæ”¯æŒåµŒå¥—å¯¹è±¡ï¼‰
        function renderParameterFieldRows(fields, level) {
            let html = '';
            fields.forEach(field => {
                const hasChildren = field.children && field.children.length > 0;
                const indentStyle = 'padding-left: ' + (level * 15) + 'px';

                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">
                            <div class="flex items-center" style="${indentStyle}">
                                ${hasChildren ?
                                    '<svg class="w-3 h-3 mr-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>' :
                                    '<span class="w-3 mr-1"></span>'
                                }
                                <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-mono">${field.name}</code>
                            </div>
                        </td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getFieldTypeClass(field.type)}">
                                ${field.type}
                            </span>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-600">
                            <div class="max-w-xs">
                                ${field.description || '<span class="text-gray-400 italic">æš‚æ— è¯´æ˜</span>'}
                            </div>
                        </td>
                    </tr>
                `;

                // é€’å½’æ¸²æŸ“å­å­—æ®µ
                if (hasChildren) {
                    html += renderParameterFieldRows(field.children, level + 1);
                }
            });
            return html;
        }

        // ç”Ÿæˆå­—æ®µç¤ºä¾‹å€¼
        function generateFieldExampleValue(field) {
            // å¦‚æœæœ‰æ˜ç¡®çš„ç¤ºä¾‹å€¼ï¼Œä½¿ç”¨ç¤ºä¾‹å€¼
            if (field.example && field.example.trim() !== '') {
                try {
                    // å°è¯•è§£æä¸ºJSONï¼ˆå¦‚æœæ˜¯æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰
                    if (field.type === 'integer' || field.type === 'int' || field.type === 'long') {
                        return parseInt(field.example);
                    } else if (field.type === 'double' || field.type === 'float') {
                        return parseFloat(field.example);
                    } else if (field.type === 'boolean') {
                        return field.example.toLowerCase() === 'true';
                    } else {
                        return field.example;
                    }
                } catch (e) {
                    return field.example;
                }
            }

            // æ ¹æ®å­—æ®µç±»å‹ç”Ÿæˆé»˜è®¤ç¤ºä¾‹å€¼
            switch (field.type.toLowerCase()) {
                case 'string':
                    return field.name === 'email' ? 'user@example.com' :
                           field.name === 'phone' ? '13800138000' :
                           field.name.includes('name') ? 'exampleName' : 'example';
                case 'integer':
                case 'int':
                    return 1;
                case 'long':
                    return 1001;
                case 'double':
                case 'float':
                    return 1.0;
                case 'boolean':
                    return true;
                default:
                    // å¯¹äºå¤æ‚ç±»å‹ï¼Œå¦‚æœæœ‰å­å­—æ®µå°±é€’å½’ç”Ÿæˆ
                    if (field.children && field.children.length > 0) {
                        return generateObjectExample(field.children);
                    }
                    // Listç±»å‹
                    if (field.type.startsWith('List<')) {
                        return [];
                    }
                    // Mapç±»å‹
                    if (field.type.startsWith('Map<')) {
                        return {};
                    }
                    return null;
            }
        }

        // æ ¹æ®å­—æ®µåˆ—è¡¨ç”Ÿæˆå¯¹è±¡ç¤ºä¾‹
        function generateObjectExample(fields) {
            const obj = {};
            fields.forEach(field => {
                const value = generateFieldExampleValue(field);
                if (value !== null) {
                    obj[field.name] = value;
                }
            });
            return obj;
        }

        // ç”ŸæˆRequest Bodyç¤ºä¾‹æ•°æ®
        function generateRequestBodyExample(api) {
            if (!api.parameters) return '';

            // æŸ¥æ‰¾bodyç±»å‹çš„å‚æ•°
            const bodyParam = api.parameters.find(p => p.paramType === 'body');
            if (bodyParam) {
                return generateParameterExample(bodyParam);
            }

            // å¦‚æœæ²¡æœ‰æ˜ç¡®çš„bodyå‚æ•°ï¼Œä½†æ–¹æ³•æ˜¯POST/PUT/PATCHï¼Œå°è¯•ç”ŸæˆåŸºæœ¬ç¤ºä¾‹
            if (['POST', 'PUT', 'PATCH'].includes(api.method)) {
                // æ£€æŸ¥æ˜¯å¦æœ‰å¤æ‚ç±»å‹çš„å‚æ•°å¯ä»¥ä½œä¸ºbodyç¤ºä¾‹
                const complexParam = api.parameters.find(p => p.fields && p.fields.length > 0);
                if (complexParam) {
                    return generateParameterExample(complexParam);
                }
            }

            return '';
        }

        // æ ¹æ®å‚æ•°ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateParameterExample(param) {
            if (!param.type) return '';

            // å¤„ç†æ³›å‹é›†åˆç±»å‹
            if (param.type.startsWith('List<') || param.type.startsWith('Set<')) {
                const exampleArray = [];
                if (param.fields && param.fields.length > 0) {
                    // ä»å®¹å™¨å­—æ®µä¸­æå–å…ƒç´ ç±»å‹çš„å­—æ®µä¿¡æ¯
                    const containerField = param.fields[0]; // Listå…ƒç´  æˆ– Setå…ƒç´ 
                    if (containerField && containerField.children && containerField.children.length > 0) {
                        // ç”Ÿæˆ1-2ä¸ªç¤ºä¾‹å…ƒç´ 
                        exampleArray.push(generateObjectExample(containerField.children));
                        exampleArray.push(generateObjectExample(containerField.children));
                    }
                }
                return JSON.stringify(exampleArray, null, 2);
            }

            // å¤„ç†Mapç±»å‹
            else if (param.type.startsWith('Map<')) {
                const exampleMap = {};
                if (param.fields && param.fields.length > 0) {
                    const mapValueField = param.fields[0]; // Mapå€¼
                    if (mapValueField && mapValueField.children && mapValueField.children.length > 0) {
                        exampleMap['key1'] = generateObjectExample(mapValueField.children);
                        exampleMap['key2'] = generateObjectExample(mapValueField.children);
                    } else {
                        exampleMap['key1'] = 'value1';
                        exampleMap['key2'] = 'value2';
                    }
                }
                return JSON.stringify(exampleMap, null, 2);
            }

            // å¤„ç†æ™®é€šå¯¹è±¡ç±»å‹
            else if (param.fields && param.fields.length > 0) {
                const exampleObj = generateObjectExample(param.fields);
                return JSON.stringify(exampleObj, null, 2);
            }

            return '';
        }

        // æ¸²æŸ“APIæµ‹è¯•
        function renderApiTesting(api) {
            // åˆå§‹åŒ–Headers
            initializeHeaders();

            // æ¸²æŸ“å‚æ•°è¡¨å•
            renderParametersForm(api);

            // æ›´æ–°è¯·æ±‚é¢„è§ˆ
            updateRequestPreview();
        }

        // æ¸²æŸ“å‚æ•°è¡¨å•
        function renderParametersForm(api) {
            const container = document.getElementById('parameters-container');
            const requestBodySection = document.getElementById('request-body-section');

            let html = '';

            if (api.parameters && api.parameters.length > 0) {
                api.parameters.forEach(param => {
                    if (param.paramType !== 'body') {
                        // ä¸ºæ–‡ä»¶ç±»å‹å‚æ•°åˆ›å»ºç‰¹æ®Šçš„æ–‡ä»¶é€‰æ‹©æ§ä»¶
                        if (param.paramType === 'file') {
                            html += `
                                <div class="flex flex-col space-y-2 mb-4 p-3 border border-orange-200 rounded-lg bg-orange-50">
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm font-medium text-orange-800">ğŸ“ ${param.name}</label>
                                        <span class="px-2 py-1 text-xs text-orange-700 bg-orange-100 rounded-full">
                                            ${param.required ? 'å¿…å¡«' : 'å¯é€‰'}
                                        </span>
                                    </div>
                                    <input type="file"
                                           class="file-input w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100"
                                           data-param-name="${param.name}"
                                           ${param.type.includes('List<') || param.type.includes('[]') ? 'multiple' : ''}>
                                    <div class="text-xs text-orange-600">
                                        ${param.description || 'è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶'}
                                    </div>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="flex space-x-2 mb-2">
                                    <input type="text" value="${param.name}" readonly
                                           class="w-32 px-3 py-2 border border-gray-300 rounded-md text-sm bg-gray-50">
                                    <input type="text" placeholder="${param.example || param.type}"
                                           class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm param-value"
                                           data-param-name="${param.name}">
                                    <span class="px-3 py-2 text-sm text-gray-500 bg-gray-50 rounded-md">
                                        ${param.required ? 'å¿…å¡«' : 'å¯é€‰'}
                                    </span>
                                </div>
                            `;
                        }
                    }
                });
            }

            container.innerHTML = html || '<div class="text-gray-500 text-sm">æ— å‚æ•°</div>';

            // æ˜¾ç¤º/éšè—Request Body
            const hasBodyParam = api.parameters?.some(p => p.paramType === 'body') || ['POST', 'PUT', 'PATCH'].includes(api.method);
            const hasFileParam = api.parameters?.some(p => p.paramType === 'file');

            // å¦‚æœæœ‰æ–‡ä»¶å‚æ•°ï¼Œéšè—Request Body
            requestBodySection.style.display = (hasBodyParam && !hasFileParam) ? 'block' : 'none';

            // å¦‚æœæ˜¾ç¤ºRequest Bodyï¼Œå¡«å……ç¤ºä¾‹æ•°æ®
            if (hasBodyParam && !hasFileParam) {
                const requestBodyTextarea = document.getElementById('request-body');
                if (requestBodyTextarea) {
                    const exampleData = generateRequestBodyExample(api);
                    if (exampleData) {
                        requestBodyTextarea.value = exampleData;
                    }
                }
            }

            // ç›‘å¬å‚æ•°å˜åŒ–
            container.addEventListener('input', updateRequestPreview);

            // ç›‘å¬Request Bodyå˜åŒ–
            const requestBodyEl = document.getElementById('request-body');
            if (requestBodyEl) {
                requestBodyEl.addEventListener('input', updateRequestPreview);
            }

            // ç›‘å¬æ–‡ä»¶é€‰æ‹©å˜åŒ–
            container.addEventListener('change', function(e) {
                if (e.target.classList.contains('file-input')) {
                    updateRequestPreview();
                }
            });
        }

        // æ›´æ–°è¯·æ±‚é¢„è§ˆ
        function updateRequestPreview() {
            if (!selectedApi) return;

            const preview = document.getElementById('request-preview');
            let url = selectedApi.path;
            let body = '';
            let previewText = '';

            // æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å‚æ•°
            const fileInputs = document.querySelectorAll('.file-input');
            const hasFiles = fileInputs.length > 0;

            // æ„å»ºURLå‚æ•°
            const paramValues = Array.from(document.querySelectorAll('.param-value'));
            const queryParams = [];

            paramValues.forEach(input => {
                const value = input.value.trim();
                if (value) {
                    const paramName = input.dataset.paramName;
                    if (url.includes(`{${paramName}}`)) {
                        url = url.replace(`{${paramName}}`, value);
                    } else {
                        queryParams.push(`${paramName}=${encodeURIComponent(value)}`);
                    }
                }
            });

            if (queryParams.length > 0) {
                url += '?' + queryParams.join('&');
            }

            // æ„å»ºé¢„è§ˆ
            previewText = `${selectedApi.method} ${url} HTTP/1.1\n`;
            previewText += `Host: ${window.location.host}\n`;

            if (hasFiles) {
                // æ–‡ä»¶ä¸Šä¼ é¢„è§ˆ
                previewText += `Content-Type: multipart/form-data\n\n`;
                previewText += `--- FormData ---\n`;

                // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                fileInputs.forEach(fileInput => {
                    const paramName = fileInput.dataset.paramName;
                    if (fileInput.files.length > 0) {
                        Array.from(fileInput.files).forEach((file, index) => {
                            previewText += `${paramName}${fileInput.multiple && index > 0 ? `[${index}]` : ''}: ${file.name} (${(file.size / 1024).toFixed(2)} KB)\n`;
                        });
                    } else {
                        previewText += `${paramName}: <æœªé€‰æ‹©æ–‡ä»¶>\n`;
                    }
                });

                // æ˜¾ç¤ºå…¶ä»–å‚æ•°
                paramValues.forEach(input => {
                    const value = input.value.trim();
                    if (value) {
                        const paramName = input.dataset.paramName;
                        if (!url.includes(`{${paramName}}`) && !url.includes(`${paramName}=`)) {
                            previewText += `${paramName}: ${value}\n`;
                        }
                    }
                });
            } else {
                // å¸¸è§„è¯·æ±‚é¢„è§ˆ
                const headers = getAllHeaders();
                Object.entries(headers).forEach(([key, value]) => {
                    previewText += `${key}: ${value}\n`;
                });

                // è·å–è¯·æ±‚ä½“
                const requestBodyEl = document.getElementById('request-body');
                if (requestBodyEl && requestBodyEl.style.display !== 'none') {
                    body = requestBodyEl.value.trim();
                }

                if (body) {
                    previewText += `\n${body}`;
                }
            }

            preview.textContent = previewText;
        }

        // å¤„ç†å‘é€è¯·æ±‚
        async function handleSendRequest() {
            if (!selectedApi) return;

            showLoading(true);

            try {
                // æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å‚æ•°
                const fileInputs = document.querySelectorAll('.file-input');
                const hasFiles = fileInputs.length > 0;

                // æ„å»ºè¯·æ±‚URL
                let url = selectedApi.path;
                const paramValues = Array.from(document.querySelectorAll('.param-value'));
                const queryParams = [];

                paramValues.forEach(input => {
                    const value = input.value.trim();
                    if (value) {
                        const paramName = input.dataset.paramName;
                        if (url.includes(`{${paramName}}`)) {
                            url = url.replace(`{${paramName}}`, value);
                        } else {
                            queryParams.push(`${paramName}=${encodeURIComponent(value)}`);
                        }
                    }
                });

                if (queryParams.length > 0) {
                    url += '?' + queryParams.join('&');
                }

                // æ„å»ºè¯·æ±‚é€‰é¡¹
                const options = {
                    method: selectedApi.method
                };

                if (hasFiles) {
                    // æ–‡ä»¶ä¸Šä¼ ä½¿ç”¨ FormData
                    const formData = new FormData();

                    // æ·»åŠ æ–‡ä»¶
                    fileInputs.forEach(fileInput => {
                        const paramName = fileInput.dataset.paramName;
                        if (fileInput.multiple) {
                            // å¤šæ–‡ä»¶ä¸Šä¼ 
                            Array.from(fileInput.files).forEach(file => {
                                formData.append(paramName, file);
                            });
                        } else {
                            // å•æ–‡ä»¶ä¸Šä¼ 
                            if (fileInput.files[0]) {
                                formData.append(paramName, fileInput.files[0]);
                            }
                        }
                    });

                    // æ·»åŠ å…¶ä»–å‚æ•°
                    paramValues.forEach(input => {
                        const value = input.value.trim();
                        if (value) {
                            const paramName = input.dataset.paramName;
                            // é¿å…é‡å¤æ·»åŠ URLè·¯å¾„å‚æ•°
                            if (!url.includes(`{${paramName}}`) && !url.includes(`${paramName}=`)) {
                                formData.append(paramName, value);
                            }
                        }
                    });

                    options.body = formData;
                } else {
                    // éæ–‡ä»¶ä¸Šä¼ çš„å¸¸è§„å¤„ç†
                    const customHeaders = getAllHeaders();
                    options.headers = customHeaders;

                    // æ·»åŠ è¯·æ±‚ä½“
                    const requestBodyEl = document.getElementById('request-body');
                    if (requestBodyEl && requestBodyEl.value.trim() && ['POST', 'PUT', 'PATCH'].includes(selectedApi.method)) {
                        try {
                            JSON.parse(requestBodyEl.value); // éªŒè¯JSONæ ¼å¼
                            options.body = requestBodyEl.value;
                        } catch (e) {
                            throw new Error('è¯·æ±‚ä½“JSONæ ¼å¼ä¸æ­£ç¡®');
                        }
                    }
                }

                // å‘é€è¯·æ±‚
                const startTime = Date.now();
                const response = await fetch(url, options);
                const endTime = Date.now();
                const responseText = await response.text();

                // æ˜¾ç¤ºå“åº”ç»“æœ
                showResponse(response, responseText, endTime - startTime);

            } catch (error) {
                showResponseError(error.message);
            } finally {
                showLoading(false);
            }
        }

        // æ˜¾ç¤ºå“åº”ç»“æœ
        function showResponse(response, responseText, duration) {
            const responseSection = document.getElementById('response-section');
            const responseStatus = document.getElementById('response-status');
            const responseBody = document.getElementById('response-body');

            responseSection.classList.remove('hidden');

            // çŠ¶æ€ä¿¡æ¯
            const statusClass = response.ok ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            responseStatus.className = `mb-3 p-3 rounded-md ${statusClass}`;
            responseStatus.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="font-semibold">çŠ¶æ€: ${response.status} ${response.statusText}</span>
                    <span class="text-sm">è€—æ—¶: ${duration}ms</span>
                </div>
            `;

            // å“åº”ä½“
            let formattedResponse = responseText;
            try {
                const jsonResponse = JSON.parse(responseText);
                formattedResponse = JSON.stringify(jsonResponse, null, 2);
            } catch (e) {
                // ä¸æ˜¯JSONæ ¼å¼ï¼Œä¿æŒåŸæ ·
            }

            responseBody.textContent = formattedResponse;
        }

        // æ˜¾ç¤ºå“åº”é”™è¯¯
        function showResponseError(errorMessage) {
            const responseSection = document.getElementById('response-section');
            const responseStatus = document.getElementById('response-status');
            const responseBody = document.getElementById('response-body');

            responseSection.classList.remove('hidden');

            responseStatus.className = 'mb-3 p-3 rounded-md bg-red-100 text-red-800';
            responseStatus.innerHTML = `<span class="font-semibold">è¯·æ±‚å¤±è´¥: ${errorMessage}</span>`;

            responseBody.textContent = '';
        }

        // æ¸²æŸ“APIç¤ºä¾‹
        function renderApiExamples(api) {
            const examples = document.getElementById('api-examples');

            if (api.examples && Object.keys(api.examples).length > 0) {
                let html = '';
                Object.entries(api.examples).forEach(([key, example]) => {
                    html += `
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 capitalize">
                                ${key === 'success' ? 'âœ… æˆåŠŸç¤ºä¾‹' : key === 'error' ? 'âŒ é”™è¯¯ç¤ºä¾‹' : `ğŸ“‹ ${key}`}
                            </h3>
                            <pre class="bg-gray-50 p-4 rounded-md text-sm code-block border border-gray-200 overflow-x-auto">${JSON.stringify(example, null, 2)}</pre>
                        </div>
                    `;
                });
                examples.innerHTML = html;
            } else {
                examples.innerHTML = '<div class="text-gray-500">æš‚æ— ç¤ºä¾‹æ•°æ®</div>';
            }
        }

        // å¤„ç†Tabåˆ‡æ¢
        function handleTabSwitch(tabName) {
            // æ›´æ–°TabçŠ¶æ€
            document.querySelectorAll('.api-tab').forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.className = 'api-tab py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600';
                } else {
                    tab.className = 'api-tab py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';
                }
            });

            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        }

        // å¤„ç†æœç´¢
        function handleSearch() {
            const query = searchInput.value.toLowerCase().trim();

            if (!query) {
                renderApiGroups();
                return;
            }

            // è¿‡æ»¤API
            const filteredGroups = currentApiDoc.groups.map(group => ({
                ...group,
                apis: group.apis.filter(api =>
                    api.summary.toLowerCase().includes(query) ||
                    api.path.toLowerCase().includes(query) ||
                    api.method.toLowerCase().includes(query)
                )
            })).filter(group => group.apis.length > 0);

            // æ¸²æŸ“è¿‡æ»¤ç»“æœ
            let html = '';
            if (filteredGroups.length === 0) {
                html = '<div class="text-center text-gray-500 py-4">æœªæ‰¾åˆ°åŒ¹é…çš„API</div>';
            } else {
                filteredGroups.forEach((group, groupIndex) => {
                    // æœç´¢æ—¶é»˜è®¤å±•å¼€æ‰€æœ‰åˆ†ç»„
                    html += `
                        <div class="mb-4 api-group" data-group-name="${group.name}">
                            <div class="group-header cursor-pointer flex items-center justify-between p-2 hover:bg-gray-50 rounded-md">
                                <h3 class="text-sm font-semibold text-gray-900 flex items-center">
                                    <span class="group-toggle mr-2 text-gray-400 expanded">â–¶</span>
                                    <span class="mr-2">ğŸ“</span>
                                    ${group.name}
                                </h3>
                                <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${group.apis.length}</span>
                            </div>
                            <div class="group-apis ml-4 expanded">
                    `;

                    group.apis.forEach((api, apiIndex) => {
                        const globalIndex = getGlobalApiIndex(groupIndex, apiIndex);
                        const pathHtml = generatePathHtml(api.path);

                        html += `
                            <div class="api-item api-item-compact cursor-pointer p-3 rounded hover:bg-gray-50 border-l-4 border-transparent hover:border-blue-400 transition-all"
                                 data-api-index="${globalIndex}">
                                <!-- ç¬¬ä¸€è¡Œï¼šHTTPæ–¹æ³• + çŠ¶æ€æ ‡ç­¾ -->
                                <div class="flex items-center justify-between mb-2">
                                    <span class="method-badge method-${api.method.toLowerCase()} px-2 py-1 rounded text-xs font-medium border">
                                        ${api.method}
                                    </span>
                                    <span class="status-badge status-${api.statusCss}">
                                        ${api.statusLabel}
                                    </span>
                                </div>
                                <!-- ç¬¬äºŒè¡Œï¼šAPIè·¯å¾„ -->
                                <div class="text-sm text-gray-700 mb-1 font-mono">
                                    ${highlightText(pathHtml, query)}
                                </div>
                                <!-- ç¬¬ä¸‰è¡Œï¼šAPIæè¿° -->
                                <div class="text-xs text-gray-600 truncate">
                                    ${highlightText(api.summary, query)}
                                </div>
                            </div>
                        `;
                    });

                    html += '</div></div>';
                });
            }

            apiGroups.innerHTML = html;
        }

        // é«˜äº®æœç´¢æ–‡æœ¬
        function highlightText(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi');
            return text.replace(regex, '<mark class="bg-yellow-200">$1</mark>');
        }

        // è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ®Šå­—ç¬¦
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // å¤„ç†ç¯å¢ƒåˆ‡æ¢
        function handleEnvironmentChange() {
            loadApiDocumentation();
        }

        // å¤„ç†åˆ·æ–°
        function handleRefresh() {
            loadApiDocumentation();
        }

        // å¤„ç†ä¸»é¢˜åˆ‡æ¢
        function handleThemeToggle() {
            document.body.classList.toggle('dark');
            // è¿™é‡Œå¯ä»¥å®ç°æ›´å¤æ‚çš„ä¸»é¢˜åˆ‡æ¢é€»è¾‘
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show) {
            if (show) {
                loadingOverlay.classList.remove('hidden');
            } else {
                loadingOverlay.classList.add('hidden');
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            // è¿™é‡Œå¯ä»¥å®ç°æ›´å¥½çš„é”™è¯¯æç¤º
            alert(message);
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>